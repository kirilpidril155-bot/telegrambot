// Telegram Mini App ‚Äî Full Store with Cart, Crypto & Mobile Optimization
import React, { useState } from "react";
import { motion } from "framer-motion";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { ShoppingCart, ArrowLeft, Trash2, Plus, Minus } from "lucide-react";

// ===== –î–ê–ù–ù–´–ï –¢–û–í–ê–†–û–í =====
const productsData = {
  "–¢–æ–≤–∞—Ä 1": [
    { name: "1.üçç–¶–≤–µ—Çüçç", prices: { 3.5: 40, 7: 70, 14: 130 } },
    { name: "2.üçí–¶–≤–µ—Çüçí", prices: { 3.5: 40, 7: 70, 14: 130 } },
    { name: "3.üíÆ–¶–≤–µ—ÇüíÆ", prices: { 3.5: 40, 7: 70, 14: 130 } },
    { name: "4.üçÉ–¶–≤–µ—ÇüçÉ", prices: { 3.5: 80, 7: 150, 14: 270, 28: 450 } },
    { name: "5.‚ô•Ô∏è–¶–≤–µ—Ç‚ô•Ô∏è", prices: { 3.5: 40, 7: 70, 14: 130 } },
    { name: "6.üêò–¶–≤–µ—Çüêò", prices: { 3.5: 40, 7: 70, 14: 130 } },
    { name: "7.üç´–¶–≤–µ—Çüç´", prices: { 3.5: 40, 7: 80, 14: 120 } },
    { name: "8.üßÅ–¶–≤–µ—ÇüßÅ", prices: { 1: 70, 2: 120, 3: 160 } },
  ],
  "–¢–æ–≤–∞—Ä 2": [
    { name: "1.ü••–¶–≤–µ—Çü••", prices: { 1: 70, 2: 120, 3: 160 } },
    { name: "2.üßä–¶–≤–µ—Çüßä", prices: { 1: 17, 2: 30, 4: 55, 6: 90 } },
    { name: "3.‚ùÑÔ∏è–¶–≤–µ—Ç‚ùÑÔ∏è", prices: { 1: 25, 2: 45, 3: 60, 4: 80 } },
  ],
  "–¢–æ–≤–∞—Ä 3": [
    { name: "1.üíä–¶–≤–µ—Çüíä", prices: { 1: 10, 2: 20, 3: 25, 6: 45, 12: 80 } },
    { name: "2.üçÑ–¶–≤–µ—ÇüçÑ", prices: { 3.5: 40, 7: 70, 14: 130 } },
    { name: "3.üëΩ–¶–≤–µ—ÇüëΩ", prices: { 2.5: 320, 5: 500, 7.5: 650 } },
  ],
  "–¢–æ–≤–∞—Ä 4": [
    { name: "1.üåà–¶–≤–µ—Çüåà", prices: { 5: 30, 10: 55, 15: 100, 25: 170 } },
    { name: "2.ü•≠–¶–≤–µ—Çü•≠", prices: { 5: 30, 10: 55, 15: 100, 25: 170 } },
    { name: "3.üî•–¶–≤–µ—Çüî•", prices: { 1: 35, 2: 60, 4: 100 } },
  ],
  "–¢–æ–≤–∞—Ä 5": [
    { name: "üçè–¶–≤–µ—Çüçè", prices: { 5: 120 } },
    { name: "üçì–¶–≤–µ—Çüçì", prices: { 2: 80 } },
    { name: "üå¥–¶–≤–µ—Çüå¥", prices: { 5: 120 } },
    { name: "üçã–¶–≤–µ—Çüçã", prices: { 2: 80 } },
    { name: "üçá–¶–≤–µ—Çüçá", prices: { 2: 80 } },
    { name: "üíú–¶–≤–µ—Çüíú", prices: { 2: 80 } },
  ],
  "–¢–æ–≤–∞—Ä 6": [
    { name: "üç´–¶–≤–µ—Çüç´", prices: { 14: 90 } },
    { name: "üéÅ–¶–≤–µ—ÇüéÅ", prices: { 21: 150 } },
    { name: "üéÅüéÅ–¶–≤–µ—ÇüéÅüéÅ", prices: { 19: 170 } },
  ],
};

// ===== –§–û–¢–û –¢–û–í–ê–†–û–í =====
const categoryImages = {
  "–¢–æ–≤–∞—Ä 1": [
    "https://i.postimg.cc/TYSLvKht/IMG-20251001-143808-938.jpg",
    "https://i.postimg.cc/xTqJZvjh/IMG-20251001-143810-989.jpg",
    "https://i.postimg.cc/wTPyY13G/IMG-20251001-143813-440.jpg",
    "https://i.postimg.cc/J4gDCstK/IMG-20251001-143815-161.jpg",
  ],
  "–¢–æ–≤–∞—Ä 2": [
    "https://i.postimg.cc/44YHLvxL/IMG-20251001-143824-749.jpg",
    "https://i.postimg.cc/bY4DKGZ6/IMG-20251001-143827-144.jpg",
  ],
  "–¢–æ–≤–∞—Ä 3": [
    "https://i.postimg.cc/DfRJtWSx/IMG-20251001-143830-106.jpg",
    "https://i.postimg.cc/Y2TGJ4vy/IMG-20251001-143832-634.jpg",
  ],
  "–¢–æ–≤–∞—Ä 4": [
    "https://i.postimg.cc/KvLkFZLy/IMG-20251001-143835-844.jpg",
    "https://i.postimg.cc/8PWJD1WS/IMG-20251001-143837-819.jpg",
  ],
  "–¢–æ–≤–∞—Ä 5": [
    "https://i.postimg.cc/7YqXJQVD/IMG-20251001-133953-876.jpg",
    "https://i.postimg.cc/T3w9CLFk/IMG-20251001-133909-190.jpg",
  ],
  "–¢–æ–≤–∞—Ä 6": [
    "https://i.postimg.cc/yx8PtDWJ/fwgwtwtgwrg.jpg",
    "https://i.postimg.cc/dVY7VzmX/image.png",
  ],
};

// ===== –ö–†–ò–ü–¢–û–í–ê–õ–Æ–¢–´ =====
const currencies = {
  BNB: { rate: 0.0014, wallet: "0xF879a1050307C2E7272CF57A9a6AF6088A307d4B" },
  ETH: { rate: 0.0003, wallet: "0xF879a1050307C2E7272CF57A9a6AF6088A307d4B" },
  USDT: { rate: 1.34, wallet: "0xF879a1050307C2E7272CF57A9a6AF6088A307d4B" },
  SOL: { rate: 0.0067, wallet: "9JfQ2UhDnBXkGSMceVjWEjAnfkGXFjQMkGmRkwZkBKK8" },
  USDC: { rate: 1.34, wallet: "0xF879a1050307C2E7272CF57A9a6AF6088A307d4B" },
};

// ===== –ì–û–†–û–î–ê =====
const cities = [
  "–ú–æ—Å–∫–≤–∞",
  "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
  "–ö–∞–∑–∞–Ω—å",
  "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥",
  "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫",
  "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥",
  "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É",
  "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä",
  "–°–∞–º–∞—Ä–∞",
  "–ß–µ–ª—è–±–∏–Ω—Å–∫",
];

// ===== –û–°–ù–û–í–ù–û–ô –ö–û–ú–ü–û–ù–ï–ù–¢ =====
export default function App() {
  const [city, setCity] = useState(null);
  const [category, setCategory] = useState(null);
  const [selectedColor, setSelectedColor] = useState(null);
  const [cart, setCart] = useState([]);
  const [currency, setCurrency] = useState(null);
  const [view, setView] = useState("city");

  const addToCart = (item) => {
    const existing = cart.find(
      (c) => c.color === item.color && c.qty === item.qty
    );
    if (existing) {
      existing.count += 1;
      setCart([...cart]);
    } else {
      setCart([...cart, { ...item, count: 1 }]);
    }
  };

  const removeItem = (index) => {
    setCart(cart.filter((_, i) => i !== index));
  };

  const updateCount = (index, delta) => {
    const newCart = [...cart];
    newCart[index].count = Math.max(1, newCart[index].count + delta);
    setCart(newCart);
  };

  const totalPrice = cart.reduce(
    (sum, i) => sum + i.price * i.count,
    0
  );

  return (
    <div className="min-h-screen bg-gradient-to-b from-zinc-900 to-black text-white p-3 text-sm">
      {/* ===== –í–´–ë–û–† –ì–û–†–û–î–ê ===== */}
      {view === "city" && (
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }}>
          <h1 className="text-2xl font-bold mb-4 text-center">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ üèôÔ∏è</h1>
          <div className="grid grid-cols-2 gap-2">
            {cities.map((c) => (
              <Button
                key={c}
                onClick={() => {
                  setCity(c);
                  setView("products");
                }}
                className="text-xs py-4"
              >
                {c}
              </Button>
            ))}
          </div>
        </motion.div>
      )}

      {/* ===== –ö–ê–¢–ï–ì–û–†–ò–ò / –¢–û–í–ê–†–´ ===== */}
      {view === "products" && (
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }}>
          <div className="flex justify-between mb-3 items-center">
            <Button variant="ghost" size="sm" onClick={() => setView("city")}>
              <ArrowLeft size={18} className="mr-1" /> –ì–æ—Ä–æ–¥
            </Button>
            <Button size="sm" onClick={() => setView("cart")}>
              <ShoppingCart size={18} className="mr-1" /> ({cart.length})
            </Button>
          </div>

          {!category && (
            <>
              <h2 className="text-lg mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é üî•</h2>
              <div className="grid grid-cols-2 gap-2">
                {Object.keys(productsData).map((cat) => (
                  <Button
                    key={cat}
                    onClick={() => setCategory(cat)}
                    className="text-sm py-4"
                  >
                    {cat}
                  </Button>
                ))}
              </div>
            </>
          )}

          {category && !selectedColor && (
            <>
              <Button variant="ghost" size="sm" onClick={() => setCategory(null)}>
                <ArrowLeft size={18} className="mr-1" /> –ù–∞–∑–∞–¥
              </Button>
              <h3 className="text-lg mt-2 mb-1">{category}</h3>
              <div className="flex overflow-x-auto gap-2 pb-2">
                {categoryImages[category]?.map((img, i) => (
                  <img
                    key={i}
                    src={img}
                    alt=""
                    className="w-32 h-32 object-cover rounded-lg flex-shrink-0"
                  />
                ))}
              </div>
              <div className="grid grid-cols-2 gap-2 mt-2">
                {productsData[category].map((color) => (
                  <Button
                    key={color.name}
                    onClick={() => setSelectedColor(color)}
                    className="text-xs py-3"
                  >
                    {color.name}
                  </Button>
                ))}
              </div>
            </>
          )}

          {selectedColor && (
            <>
              <Button variant="ghost" size="sm" onClick={() => setSelectedColor(null)}>
                <ArrowLeft size={18} className="mr-1" /> –ù–∞–∑–∞–¥
              </Button>
              <h3 className="text-md mt-2 mb-2">{selectedColor.name}</h3>
              <div className="grid grid-cols-2 gap-2">
                {Object.entries(selectedColor.prices).map(([qty, price]) => (
                  <Card
                    key={qty}
                    className="p-2 cursor-pointer"
                    onClick={() => addToCart({ category, color: selectedColor.name, qty: Number(qty), price })}
                  >
                    <CardContent>
                      {qty} –≥ ‚Äî {price} ¬£
                      <p className="text-xs text-gray-400">–î–æ–±–∞–≤–∏—Ç—å</p>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </>
          )}
        </motion.div>
      )}

      {/* ===== –ö–û–†–ó–ò–ù–ê ===== */}
      {view === "cart" && (
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }}>
          <div className="flex justify-between mb-3">
            <Button variant="ghost" size="sm" onClick={() => setView("products")}>
              <ArrowLeft size={18} className="mr-1" /> –ù–∞–∑–∞–¥
            </Button>
          </div>
          <h2 className="text-lg mb-2">üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>
          {cart.length === 0 ? (
            <p className="text-gray-400">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</p>
          ) : (
            <>
              {cart.map((item, idx) => (
                <Card key={idx} className="mb-2 p-2">
                  <CardContent className="flex justify-between items-center">
                    <div>
                      <p className="font-semibold text-sm">
                        {item.color} ‚Äî {item.qty}–≥
                      </p>
                      <p className="text-xs text-gray-400">
                        {item.price} ¬£ √ó {item.count} = {item.price * item.count} ¬£
                      </p>
                    </div>
                    <div className="flex items-center gap-1">
                      <Button size="icon" onClick={() => updateCount(idx, -1)}>
                        <Minus size={14} />
                      </Button>
                      <span>{item.count}</span>
                      <Button size="icon" onClick={() => updateCount(idx, 1)}>
                        <Plus size={14} />
                      </Button>
                      <Button variant="destructive" size="icon" onClick={() => removeItem(idx)}>
                        <Trash2 size={14} />
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ))}
              <p className="mt-2 font-semibold text-right">üí∑ –ò—Ç–æ–≥–æ: {totalPrice} ¬£</p>

              <h3 className="text-md mt-4">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É üí±</h3>
              <div className="grid grid-cols-2 gap-2 mt-2">
                {Object.keys(currencies).map((c) => (
                  <Button key={c} onClick={() => setCurrency(c)}>
                    {c}
                  </Button>
                ))}
              </div>

              {currency && (
                <div className="mt-4">
                  <h4 className="text-md font-semibold">–û–ø–ª–∞—Ç–∞ –≤ {currency}</h4>
                  <p>
                    –°—É–º–º–∞: {(totalPrice * currencies[currency].rate).toFixed(6)} {currency}
                  </p>
                  <p className="break-all text-xs text-gray-400 mt-2">
                    –ö–æ—à–µ–ª—ë–∫: {currencies[currency].wallet}
                  </p>
                  <Button className="mt-3 w-full">–û–ø–ª–∞—Ç–∏—Ç—å</Button>
                </div>
              )}
            </>
          )}
        </motion.div>
      )}
    </div>
  );
}
